name: Run UI Tests

on: pull_request
jobs:
  test:
    runs-on: macos-latest
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - name: create local.properties file for app creds
        env:
          PORTALS_KEY: ${{ secrets.portals_key }}
        run: echo portals_key=\"$PORTALS_KEY\" > ./local.properties
      - name: set up JDK 17
        uses: actions/setup-java@v2
        with:
          java-version: '17'
          distribution: 'adopt'
      - name: Grant execute permission for gradlew
        run: chmod +x ./gradlew
      - name: run tests
        uses: reactivecircus/android-emulator-runner@v2
        with:
          api-level: 32
          arch: x86_64
          target: playstore
          script: ./gradlew connectedCheck